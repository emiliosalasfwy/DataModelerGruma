<BusinessLogic methodName="loadOnDemand" businessObjectClass="BoIssue" businessObjectType="" asynchronous="true" accessibility="PUBLIC" final="false" module="CORE" simpleEditorOnly="">
  <Parameters>
    <MethodInput name="loadMode" type="String" />
  </Parameters>
<Code language="JavaScript">
<![CDATA[var promise;

if (loadMode === "Attachments" && !Utils.isDefined(me.getLoIssueAttachments())) {

  var oldStatus = me.getObjectStatus();

  promise = BoFactory.loadObjectByParamsAsync(LO_ISSUEATTACHMENTS, me.getQueryBy("svcIssuePKey", me.getPKey())).then(
    function (loIssueAttachments) {
      if (Utils.isDefined(loIssueAttachments)) {
        me.setLoIssueAttachments(loIssueAttachments);
      } else {
        me.setLoIssueAttachments(null);
      }

      var callParams = [];
      var callQuery = {};
      callQuery.params = callParams;

      callParams.push({
        "field" : "referencePKey",
        "value" : me.getPKey()
      });

      callParams.push({
        "field" : "referencePKeyComp",
        "value" : "EQ"
      });

      return BoFactory.loadListAsync("LoAtmAttachment", callQuery);
    }).then(
    function (loAtmAttachment) {
      me.setLoAtmAttachment(loAtmAttachment);
      me.setObjectStatus(oldStatus);
    }
  );
}
else
{
  promise = when.resolve();
}]]>
</Code>
  <Return name="BoCustomer_LoadLoAttachmentAsync" value="promise" />
</BusinessLogic>