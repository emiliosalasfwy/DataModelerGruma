<BusinessLogic methodName="checkButtonVisibility" businessObjectClass="BoIssue" businessObjectType="" asynchronous="false" accessibility="PUBLIC" final="false" module="CORE" simpleEditorOnly="">
  <Parameters>
    <MethodInput name="mode" type="String" />
  </Parameters>
<Code language="JavaScript">
<![CDATA[var visible = false;
var isResponsible = false;
var customerManagementInfoLookup = me.getLuCustomerManagementInfo();
var nextStates;

//Check if current user is responsible or a substitute
if (Utils.isDefined(customerManagementInfoLookup)) {
  if (((me.getResponsiblePKey() === ApplicationContext.get('user').getPKey()) && (customerManagementInfoLookup.getHasSubstitute() === "0"))
      || ((me.getResponsiblePKey() !== customerManagementInfoLookup.getReferenceUsrMainPKey()) && (customerManagementInfoLookup.getSubstitutedInLeadFollowUpTime() === "0")
          && (customerManagementInfoLookup.getIsSubstituted() == "1"))) {

    isResponsible = true;
  }
}

switch (mode) {

  case "release":
    nextStates = me.getBoWorkflow().getNextStatesByStateType(me.getActualStatePKey(), "Released");
    if (Utils.isDefined(nextStates[0]) && isResponsible) {
      visible = true;
    }
    break;

  case "complete":
    nextStates = me.getBoWorkflow().getNextStatesByStateType(me.getActualStatePKey(), "Closed");
    if (Utils.isDefined(nextStates[0]) && isResponsible) {
      visible = true;
    }
    break;

  case "TakePicture":
  case "SelectPicture":
    if (isResponsible && me.getIssuePhase() !== "Closed" && me.getIssuePhase() !== "Cancelled") {
      visible = true;
    }
    break;
}]]>
</Code>
  <Return name="visible" value="visible" />
</BusinessLogic>