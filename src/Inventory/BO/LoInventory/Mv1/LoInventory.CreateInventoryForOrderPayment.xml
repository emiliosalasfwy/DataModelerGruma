<BusinessLogic methodName="createInventoryForOrderPayment" businessObjectClass="LoInventory" businessObjectType="listobject" asynchronous="false" accessibility="PUBLIC" final="false" module="CORE" simpleEditorOnly="">
  <Parameters>
    <MethodInput name="orderPayment" type="LiOrderPayment" />
    <MethodInput name="ivcInformation" type="Object" />
    <MethodInput name="recordTypeId" type="String" />
  </Parameters>
  <Code language="JavaScript"><![CDATA[var ivcMetaByPaymentMeta;
var ivcMainPKey;
var jsonIvcData = {};

ivcMetaByPaymentMeta = ivcInformation.ivcMetaByPaymentMeta;

// Consider only UserInventories
if (Utils.isDefined(ivcMetaByPaymentMeta)) {
  if (ivcMetaByPaymentMeta.getMetaId() === "CashFloat" && !Utils.isEmptyString(recordTypeId)) {
    ivcMainPKey = PKey.next();
    // Create inventory
    jsonIvcData = {};
    jsonIvcData.pKey = ivcMainPKey;
    jsonIvcData.id = ivcMainPKey;
    jsonIvcData.ivcMetaPKey = ivcMetaByPaymentMeta.getIvcMetaPKey();
    jsonIvcData.usrMainPKey = ivcMetaByPaymentMeta.getUsrMainPKey();
    jsonIvcData.bpaMainPKey = ivcMetaByPaymentMeta.getBpaMainPKey();
    jsonIvcData.prdMainPKey = " ";
    jsonIvcData.phase = "Active";
    jsonIvcData.validFrom = Utils.createDateToday();
    jsonIvcData.validThru = Utils.getMaxDate();
    jsonIvcData.invalid = "0";
    jsonIvcData.salesOrg = ApplicationContext.get('user').getBoUserSales().getSalesOrg();
    jsonIvcData.tmgTourPKey = ivcMetaByPaymentMeta.getTmgTourPKey();
    jsonIvcData.etpVehiclePKey = ivcMetaByPaymentMeta.getEtpVehiclePKey();
    jsonIvcData.currency = orderPayment.getCurrency();
    jsonIvcData.recordTypeId = recordTypeId;

    me.addItems([jsonIvcData]);
    me.getItemByPKey(jsonIvcData.pKey).setObjectStatus(STATE.NEW | STATE.DIRTY);
  }
}]]></Code>
  <Return name="ivcMainPKey" value="ivcMainPKey" />
</BusinessLogic>