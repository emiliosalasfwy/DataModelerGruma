<BusinessLogic methodName="processValidateReasonCode" businessObjectClass="BoOrder" businessObjectType="" asynchronous="true" accessibility="PUBLIC" final="false" module="CORE" simpleEditorOnly="">
  <Parameters>
    <MethodInput name="showMessage" type="String" />
  </Parameters>
<Code language="JavaScript">
<![CDATA[var promise = when.resolve("ok");
var showMessageInternal = "1";

if(Utils.isDefined(showMessage)){
  showMessageInternal = showMessage;
}

if (me.getBoOrderMeta().getSdoSubType() == "Delivery"){
  // Get all order items
  var validate = false;
  var itemsMain = me.getLoItems();
  var items = itemsMain.getAllItems();
  var index;

  for (index = 0; index < items.length; index++){
    var item = items[index];
    var itemMetas = me.getBoOrderMeta().getLoOrderItemMetas().getItemByPKey(item.getSdoItemMetaPKey());
    var itemValidate = me.reasonCodeItemValidation(item, itemMetas, "0");

    if(itemValidate){
      item.setModReasonEntered('PrioHigh24');
    }
    else{
      item.setModReasonEntered('EmptyImage');
    }
    validate = validate || itemValidate;
  }

  if (validate && showMessageInternal == "1") {
    var buttonValues = {};
    buttonValues[Localization.resolve("OK")] = "ok";
    promise = MessageBox.displayMessage(Localization.resolve("MessageBox_Title_Warning"), Localization.resolve("CasSdoNoModReasonEnteredAfterEdit"), buttonValues).then(
      function (input) {
        //cancel release process
        me.setSetPhaseInBeforeSave("0");
        me.setValidateForRelease("0");
        return "Cancel";
      });
  }
}]]>
</Code>
  <Return name="rtrn" value="promise" />
</BusinessLogic>