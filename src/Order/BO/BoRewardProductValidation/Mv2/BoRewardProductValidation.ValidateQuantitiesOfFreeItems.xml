<BusinessLogic methodName="validateQuantitiesOfFreeItems" businessObjectClass="BoRewardProductValidation" businessObjectType="businessobject" asynchronous="false" accessibility="PUBLIC" final="false" module="CORE" simpleEditorOnly="">
  <Parameters>
    <MethodInput name="messageCollector" type="Object" />
  </Parameters>
<Code language="JavaScript">
<![CDATA[var currentRewardFreeProducts = me.getLoRewardProducts().getItems();
var maxQuantity = 0;

currentRewardFreeProducts.forEach(function(freeProduct) {
  var reward = me.getHurdleEvaluationHelper().getLoRewards().getItemByPKey(freeProduct.promotionReward);

  if(reward.getPerFactor() >= 1) {
    maxQuantity = freeProduct.getMaxQuantityValue() * reward.getPerFactor();
  } 
  else {
    maxQuantity = freeProduct.getMaxQuantityValue();
  }

  if(maxQuantity > 0 && freeProduct.getQuantity() > maxQuantity) {
    messageCollector.add({
      "level" : "error",
      "objectClass" : "BoRewardProductValidation",
      "messageParams": {
        "productName" : freeProduct.getProductName() ,
        "maxQuantityValue": maxQuantity.toString()
      },
      "messageID" : "CasSdoFreeProductMaxValueExceeded",      
    });
  }
});]]>
</Code>
  <Return name="messageCollector" value="messageCollector" />
</BusinessLogic>