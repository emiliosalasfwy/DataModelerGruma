<BusinessLogic methodName="loadOnDemand" businessObjectClass="BoTodo" businessObjectType="" asynchronous="true" accessibility="PUBLIC" final="false" module="CORE" simpleEditorOnly="">
  <Parameters>
    <MethodInput name="loadMode" type="String" />
  </Parameters>
<Code language="JavaScript">
<![CDATA[var promise = when.resolve(me);
if (loadMode === "Attachments" && !Utils.isDefined(me.getLoTodoAttachments())) {
  var callParams = [];
  var callQuery = {};
  callQuery.params = callParams;
  callParams.push({
    "field" : "svcTodoPKey",
    "value" : me.getPKey()
  });
  callParams.push({
    "field" : "referencePKey",
    "value" : me.getPKey()
  });
  callParams.push({
    "field" : "referencePKeyComp",
    "value" : "EQ"
  });
  promise = BoFactory.loadListAsync("LoTodoAttachments", callQuery).then(
    function (todoAttachmentList) {
      me.setLoTodoAttachments(todoAttachmentList);
      return BoFactory.loadListAsync("LoAtmAttachment", callQuery);
    }).then(function (atmList) {
    me.setLoAtmAttachment(atmList);
  }); 
}]]>
</Code>
  <Return name="returnName" value="promise" />
</BusinessLogic>