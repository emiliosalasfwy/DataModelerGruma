<BusinessLogic methodName="obsolete_cpInitComplexPricing" businessObjectClass="BoTruckLoad" businessObjectType="businessobject" asynchronous="true" accessibility="PUBLIC" final="false" module="CORE" simpleEditorOnly="">
  <Parameters />
<Code language="JavaScript">
<![CDATA[var promise;

if (Utils.isDefined(window.CP)) {
  var obj = {"VariantString1": "", "VariantString2":"", "VariantString3": "", "VariantString4": "", "VariantString5": "", 
             "VariantDecimal1": 0, "VariantDecimal2": 0, "VariantDecimal3": 0, "VariantDecimal4": 0, "VariantDecimal5": 0};

  promise = CP.PricingHandler.getInstance().initOrder(me.getPKey(), me.getSdoMetaPKey(), "TruckLoad", Utils.createDateNow(), me.getCurrency(), me.cpGetRelevantAttributes(), 
                                                      ApplicationContext.get('user').getDistribChannel(), ApplicationContext.get('user').getDivision(), obj).then(
    function(){
      var obj = {"VariantItemString1": "", "VariantItemString2":"", "VariantItemString3": "", "VariantItemString4": "", "VariantItemString5": "", 
                 "VariantItemDecimal1": 0, "VariantItemDecimal2": 0, "VariantItemDecimal3": 0, "VariantItemDecimal4": 0, "VariantItemDecimal5": 0};

      var lItems = me.getLoItems().getItemObjects();
      var orderItemsBiggerZero = [];
      var variantItemAttributes = [];
      var currentItem;
      var orderItem;

      for(var i = 0; i < lItems.length; i++) {
        orderItem = lItems[i].getData();

        if (Utils.isDefined(orderItem.getQuantity()) && orderItem.getQuantity() > 0){
          orderItemsBiggerZero.push(orderItem);
          variantItemAttributes.push({"SdoItemPKey":orderItem.getPKey(), "VariantAttributes":obj });
        }
      }

      return CP.PricingHandler.getInstance().addProducts(orderItemsBiggerZero, variantItemAttributes);
    }
  );
} else {
  promise = when.resolve();
}]]>
</Code>
  <Return name="promise" value="promise" />
</BusinessLogic>