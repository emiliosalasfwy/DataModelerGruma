<BusinessLogic methodName="checkAddButtonVisibility" businessObjectClass="LoUsrDailyReportOverview" businessObjectType="listobject" asynchronous="false" accessibility="PUBLIC" final="false" module="CORE" simpleEditorOnly="">
  <Parameters>
    <MethodInput name="mode" type="String" />
  </Parameters>
<Code language="JavaScript">
<![CDATA[var visible = true;

if (mode === "add"){
  //If SF, manual time card creation not allowed when user has role 'Tour User'
  if (Utils.isSfBackend()){
    if (ApplicationContext.get('user').hasRole('TourUser')){
      visible = false;
    }
  }
  //If not SF, manual time card creation not allowed when there is already an open time card for the current user (UsrDailyReport.Phase = 'Initial', UsrDailyReport.ResponsiblePKey = current user) and user has role 'Tour User'
  else{
    if(((Utils.isDefined(ApplicationContext.get("openTimeCardPKey")) &&
         !Utils.isEmptyString(ApplicationContext.get("openTimeCardPKey"))) ||
        ApplicationContext.get('user').hasRole('TourUser'))){
      visible = false;
    }
  }
}]]>
</Code>
  <Return name="visible" value="visible" />
</BusinessLogic>