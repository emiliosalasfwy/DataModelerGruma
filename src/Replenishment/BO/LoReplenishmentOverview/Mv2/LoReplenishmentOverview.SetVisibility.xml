<BusinessLogic methodName="setVisibility" businessObjectClass="LoReplenishmentOverview" businessObjectType="listobject" asynchronous="false" accessibility="PUBLIC" final="false" module="CORE" simpleEditorOnly="">
  <Parameters>
    <MethodInput name="token" type="String" />
  </Parameters>
<Code language="JavaScript">
<![CDATA[var visible = false;

if (token === "NewDocument"){
  var activeReplenishmentList;

  //Check on Tour in context Running Status && Customer Assigned to User.
  if(Utils.isDefined(ApplicationContext.get('currentTourStatus')) &&
     ApplicationContext.get('currentTourStatus').toLowerCase() == "running"){
    if (Utils.isDefined(Framework.getProcessContext().luReplenishmentCustomer) &&
        !Utils.isEmptyString(Framework.getProcessContext().luReplenishmentCustomer.getPKey())){
      visible = true;
    }
  }

  //Available Replenishment Meta List for running tour
  if (Utils.isDefined(Framework.getProcessContext().replenishmentMetaList)){
    activeReplenishmentList = Framework.getProcessContext().replenishmentMetaList;
  }

  // No Replenishment template exists related to the running tour
  if (visible && Utils.isDefined(activeReplenishmentList) && activeReplenishmentList.getAllItems().length === 0){
    visible = false;
  }
}]]>
</Code>
  <Return name="visible" value="visible" />
</BusinessLogic>