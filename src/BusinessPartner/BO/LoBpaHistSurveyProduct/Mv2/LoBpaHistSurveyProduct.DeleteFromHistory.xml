<BusinessLogic methodName="deleteFromHistory" businessObjectClass="LoBpaHistSurveyProduct" businessObjectType="" asynchronous="false" accessibility="PUBLIC" final="false" module="CORE" simpleEditorOnly="">
  <Parameters>
    <MethodInput name="prdMainPKey" type="String" />
    <MethodInput name="posPKey" type="String" />
    <MethodInput name="clbMetaPKey" type="String" />
    <MethodInput name="bpaCustomerPKey" type="String" />
  </Parameters>
<Code language="JavaScript">
<![CDATA[var idxHistProducts = 0;
var aHistPrdForProduct = me.getItemsByParamArray([{
  "prdMainPKey" : prdMainPKey,
  "op" : "EQ"
}, {
  "objectStatus" : STATE.DELETED,
  "op" : "NE"
}]);

if (Utils.isEmptyString(posPKey)) {
  // Store ==> delete all bpahistproducts of that product
  for (idxHistProducts; idxHistProducts < aHistPrdForProduct.length; idxHistProducts++) {
    aHistPrdForProduct[idxHistProducts].delete();
  }
}
else {
  // Delete from POS
  // Either a) delete POS entry if other entries exists for this product
  // or     b) convert it to store entry
  var storeEntryExists = false;
  var liSelectedPos = null;

  for (idxHistProducts; idxHistProducts < aHistPrdForProduct.length; idxHistProducts++) {
    if (aHistPrdForProduct[idxHistProducts].getBpaPOSPKey() === posPKey) {
      liSelectedPos = aHistPrdForProduct[idxHistProducts];
    }
    storeEntryExists = (aHistPrdForProduct[idxHistProducts].getBpaPOSPKey() !== posPKey);
  }

  if (Utils.isDefined(liSelectedPos)) {
    if (storeEntryExists) {
      liSelectedPos.delete();
    }
    else {
      liSelectedPos.setBpaPOSPKey(" ");
    }
  }
}]]>
</Code>
  <Return name="" value="" />
</BusinessLogic>