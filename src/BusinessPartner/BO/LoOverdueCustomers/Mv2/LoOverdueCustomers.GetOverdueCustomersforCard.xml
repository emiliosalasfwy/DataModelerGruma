<BusinessLogic methodName="getOverdueCustomersforCard" businessObjectClass="LoOverdueCustomers" businessObjectType="listobject" asynchronous="true" accessibility="PUBLIC" final="false" module="CORE" simpleEditorOnly="">
  <Parameters>
    <MethodInput name="cardDate" type="String" />
  </Parameters>
<Code language="JavaScript">
<![CDATA[///Double conversion is needed  here as no Utils Function is available to replace
//returns Date with TimeStamp
var jsonQuery = {
  "cardDate" : Utils.isCasBackend() ? Utils.convertDateTime2Ansi(Utils.convertAnsiDate2Date(cardDate)) : cardDate ,
  "limitDueToFormFactor" : Utils.isPhone() ? 3 : 5
};

if (Utils.isSfBackend()) {
  jsonQuery.addCond_LeadTimeFollowUpTime = " ((SubBpaRelValidFrom <= #cardDate# AND SubBpaRelValidThru >= #cardDate#) OR Account_Manager__c.Id IS NOT NULL ) AND ";
}
else {
  jsonQuery.addCond_LeadTimeFollowUpTime = " (((DATETIME (SubBpaRelValidFrom) <= #cardDate# AND DATETIME (SubBpaRelValidThru) >= #cardDate#)) OR BpaManagement.Pkey IS NOT NULL ) AND ";
}
me.removeAllItems();

var promise = Facade.getListAsync("LoOverdueCustomers", jsonQuery).then(
  function(listObject) {

var length = listObject.length;

for(var i=0; i<length; i++){

  if (listObject[i].jdlCount != '0' && listObject[i].promotionCount != '0'){
    listObject[i].overdueImage = "Overdue_Promo_Activities";
  }
  else if (listObject[i].jdlCount != '0' && listObject[i].promotionCount == '0'){
    listObject[i].overdueImage = "OverdueActivities";
  }
  else if (listObject[i].jdlCount == '0' && listObject[i].promotionCount != '0'){
    listObject[i].overdueImage = "OverduePromotion";
  }
  else if (listObject[i].jdlCount == '0' && listObject[i].promotionCount == '0'){
    listObject[i].overdueImage = "Overdue";
  }
}
   me.cardItemCount = length;
    me.addItems(listObject);

    return me;
  }
);]]>
</Code>
  <Return name="promise" value="promise" />
</BusinessLogic>