<BusinessLogic methodName="checkExistingContactPartner" businessObjectClass="BoCustomer" businessObjectType="businessobject" asynchronous="true" accessibility="PUBLIC" final="false" module="CORE" simpleEditorOnly="">
  <Parameters>
    <MethodInput name="pKey" type="String" />
  </Parameters>
<Code language="JavaScript">
<![CDATA[var promise;
var existingItems = me.getLoContactPartner();

var foundItems = existingItems.getItemsByParamArray([
  {
    "bpaContactPartnerPKey" : pKey,
    "op" : "EQ"
  }
]);

if(foundItems.length > 0)
{
  var buttonValues = {};
  buttonValues[Locale.translate("OK")] = "ok";
  promise = MessageBox.displayMessage(Localization.resolve("MessageBox_Title_Error"), Localization.resolve("BoCustomer_DuplicateCP"), buttonValues).then(
    function(result)
    {
      return "invalid";    
    }
  );
}
else
{
  promise = when.resolve("valid");
}]]>
</Code>
  <Return name="result" value="promise" />
</BusinessLogic>