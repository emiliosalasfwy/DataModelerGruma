<BusinessLogic methodName="cancelDeliveries" businessObjectClass="BoCall" businessObjectType="" asynchronous="true" accessibility="PUBLIC" final="false" module="CORE" simpleEditorOnly="">
  <Parameters>
    <MethodInput name="OrderPKey" type="Object" />
    <MethodInput name="reasonCode" type="Object" />
  </Parameters>
<Code language="JavaScript">
<![CDATA[var jqueryParams = [];
var jqueryQuery = {};
jqueryParams.push({
  "field" : "pKey",
  "value" : OrderPKey
});
jqueryParams.push({
  "field" : "isCanceling",
  "value" : "true"
});
jqueryQuery.params = jqueryParams;

var promise = BoFactory.loadObjectByParamsAsync("BoOrder", jqueryQuery).then(
  function(objBoOrder){
    if(objBoOrder.getBoOrderMeta().getMobilityRelevant() == "1" && objBoOrder.getPhase() === "Initial"){
      objBoOrder.cancel(reasonCode);
      objBoOrder.setObjectStatusFrozen(false);
      objBoOrder.setObjectStatus(this.self.STATE_DIRTY);
      objBoOrder.getACL().addRight(AclObjectType.OBJECT, "BoCall", AclPermission.EDIT);
      return objBoOrder.saveAsync();
    }
  });]]>
</Code>
  <Return name="promise" value="promise" />
</BusinessLogic>